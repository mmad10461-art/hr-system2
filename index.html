<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- Setup Page -->
    <div id="setupPage" class="page active">
        <div class="container mx-auto p-6 flex items-center justify-center min-h-screen">
            <div class="w-full max-w-2xl">
                <div class="bg-white rounded-xl shadow-2xl p-8">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">âš¡</div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Ø¥Ø¹Ø¯Ø§Ø¯ Supabase</h1>
                        <p class="text-gray-600">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Supabase (Ø®Ø·ÙˆØªÙŠÙ† ÙÙ‚Ø·!)</p>
                    </div>

                    <div class="bg-green-50 border-r-4 border-green-500 p-4 mb-6">
                        <p class="text-sm text-gray-700 mb-2"><strong>âœ… Ø®Ø·ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©:</strong></p>
                        <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                            <li>Ø±ÙˆØ­ Ù„Ù€ <a href="https://supabase.com" target="_blank" class="text-blue-600 underline font-bold">supabase.com</a></li>
                            <li>Ø§Ø¶ØºØ· <strong>Start your project</strong> ÙˆØ³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ GitHub</li>
                            <li>Ø£Ù†Ø´Ø¦ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ø®ØªØ± Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</li>
                            <li>Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ØŒ Ø±ÙˆØ­ Ù„Ù€ <strong>Settings â†’ API</strong></li>
                            <li>Ø§Ù†Ø³Ø® <strong>Project URL</strong> Ùˆ <strong>anon public</strong> key</li>
                        </ol>
                    </div>

                    <form id="supabaseSetupForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Supabase URL</label>
                            <input type="url" id="supabaseUrl" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://xxxxx.supabase.co" required />
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Supabase Anon Key</label>
                            <textarea id="supabaseKey" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="eyJhbGc..." rows="3" required></textarea>
                        </div>

                        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-bold">
                            âœ… Ø­ÙØ¸ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                        </button>
                    </form>

                    <div class="mt-4">
                        <button onclick="loadSavedSupabaseConfig()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200 transition-colors text-sm">
                            ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="page">
        <div class="container mx-auto p-6 flex items-center justify-center min-h-screen">
            <div class="w-full max-w-md">
                <div class="bg-white rounded-xl shadow-2xl p-8">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">ğŸ”</div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</h1>
                        <p class="text-gray-600">Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
                    </div>

                    <div id="loginError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm">
                        Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©
                    </div>

                    <form onsubmit="handleLogin(event)" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required />
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required />
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-bold">
                            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                        </button>
                    </form>

                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <button onclick="loginAsGuest()" class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                            Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø± (Ø¹Ø±Ø¶ ÙÙ‚Ø·)
                        </button>
                    </div>

                    <div class="mt-4 text-center">
                        <button onclick="backToSetup()" class="text-sm text-blue-600 hover:underline">
                            âš™ï¸ ØªØºÙŠÙŠØ± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="page">
        <div class="container mx-auto p-6">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</h1>
                        <p class="text-gray-600">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</p>
                    </div>
                    <div class="text-left">
                        <p class="text-sm text-gray-500 mb-2">Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙƒÙ€</p>
                        <div class="flex items-center gap-2">
                            <span id="userRole" class="px-4 py-2 bg-blue-100 text-blue-800 rounded-lg font-bold"></span>
                            <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div onclick="goToSection('workforce')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ‘¥</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ù‚ÙˆØ© Ø¹Ø§Ù…Ù„Ø©</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-workforce">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('forms')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ“</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ù†Ù…Ø§Ø°Ø¬</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-forms">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('contracts')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ“‹</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ù‚Ø³Ù… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-contracts">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('employee_services')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ‘”</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-employee_services">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('payroll')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ’°</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚Ø§Øª</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-payroll">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('files_dept')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ“</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ù‚Ø³Ù… Ø§Ù„Ù…Ù„ÙØ§Øª</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-files_dept">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('passports')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">âœˆï¸</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ø§Ù„Ø¬ÙˆØ§Ø²Ø§Øª</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-passports">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('attendance')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">â°</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¯ÙˆØ§Ù…</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-attendance">0 Ù…Ù„Ù</p>
                </div>

                <div onclick="goToSection('material_planning')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all">
                    <div class="text-6xl text-center mb-4">ğŸ“Š</div>
                    <h3 class="text-xl font-bold text-gray-800 text-center mb-2">ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ÙˆØ§Ø¯</h3>
                    <p class="text-gray-500 text-center text-sm" id="count-material_planning">0 Ù…Ù„Ù</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Page -->
    <div id="sectionPage" class="page">
        <div class="container mx-auto p-6">
            <button onclick="goToHome()" class="mb-6 flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow hover:shadow-lg transition-all">
                <span>â¬…ï¸</span>
                <span class="font-medium">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6 pb-4 border-b">
                    <div class="flex items-center gap-3">
                        <div class="bg-blue-100 p-3 rounded-lg text-3xl" id="sectionIcon">ğŸ“Š</div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800" id="sectionTitle">Ù‚Ø³Ù…</h2>
                            <p class="text-sm text-gray-500" id="fileCount">0 Ù…Ù„Ù</p>
                        </div>
                    </div>
                    
                    <button id="downloadAllBtn" class="hidden items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        <span>â¬‡ï¸</span>
                        <span>ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„</span>
                    </button>
                </div>

                <div id="uploadArea" class="mb-6">
                    <label id="uploadLabel" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <div class="text-4xl mb-2">ğŸ“¤</div>
                            <p class="text-sm text-gray-500">
                                <span class="font-semibold">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</span> Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª
                            </p>
                            <p class="text-xs text-gray-400 mt-1">PDF, DOC, DOCX, XLS, XLSX (Ø­ØªÙ‰ 50MB)</p>
                        </div>
                        <input type="file" class="hidden" multiple accept=".pdf,.doc,.docx,.xls,.xlsx" id="fileInput" />
                    </label>
                    
                    <div id="uploadProgress" class="hidden mt-4">
                        <div class="flex items-center gap-3">
                            <div class="loader"></div>
                            <span class="text-gray-600" id="uploadStatus">Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...</span>
                        </div>
                    </div>
                </div>

                <div id="filesList"></div>
            </div>
        </div>
    </div>

    <script>
        const { createClient } = supabase;
        let supabaseClient;

        const sections = {
            workforce: { name: 'Ù‚ÙˆØ© Ø¹Ø§Ù…Ù„Ø©', icon: 'ğŸ‘¥' },
            forms: { name: 'Ù†Ù…Ø§Ø°Ø¬', icon: 'ğŸ“' },
            contracts: { name: 'Ù‚Ø³Ù… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯', icon: 'ğŸ“‹' },
            employee_services: { name: 'Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', icon: 'ğŸ‘”' },
            payroll: { name: 'Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚Ø§Øª', icon: 'ğŸ’°' },
            files_dept: { name: 'Ù‚Ø³Ù… Ø§Ù„Ù…Ù„ÙØ§Øª', icon: 'ğŸ“' },
            passports: { name: 'Ø§Ù„Ø¬ÙˆØ§Ø²Ø§Øª', icon: 'âœˆï¸' },
            attendance: { name: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¯ÙˆØ§Ù…', icon: 'â°' },
            material_planning: { name: 'ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ÙˆØ§Ø¯', icon: 'ğŸ“Š' }
        };

        let currentUser = '';
        let currentSection = '';
        let files = {};
        Object.keys(sections).forEach(key => files[key] = []);

        const adminCredentials = {
            username: 'admin',
            password: 'admin123'
        };

        // Supabase Setup
        document.getElementById('supabaseSetupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const supabaseUrl = document.getElementById('supabaseUrl').value.trim();
            const supabaseKey = document.getElementById('supabaseKey').value.trim();

            try {
                supabaseClient = createClient(supabaseUrl, supabaseKey);
                
                // Test connection
                const { data, error } = await supabaseClient.from('hr_files').select('count');
                
                if (error && error.code !== 'PGRST116') {
                    throw new Error('ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Supabase');
                }
                
                localStorage.setItem('supabaseConfig', JSON.stringify({ supabaseUrl, supabaseKey }));
                
                document.getElementById('setupPage').classList.remove('active');
                document.getElementById('loginPage').classList.add('active');
                
                await loadAllFiles();
                alert('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                alert('Ø®Ø·Ø£: ' + error.message + '\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©\n2. Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ hr_files ÙÙŠ Supabase');
            }
        });

        function loadSavedSupabaseConfig() {
            const saved = localStorage.getItem('supabaseConfig');
            if (saved) {
                const config = JSON.parse(saved);
                document.getElementById('supabaseUrl').value = config.supabaseUrl;
                document.getElementById('supabaseKey').value = config.supabaseKey;
                alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©');
            } else {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©');
            }
        }

        function backToSetup() {
            document.getElementById('loginPage').classList.remove('active');
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('sectionPage').classList.remove('active');
            document.getElementById('setupPage').classList.add('active');
        }

        // Check if Supabase is configured
        window.addEventListener('load', async function() {
            const saved = localStorage.getItem('supabaseConfig');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    supabaseClient = createClient(config.supabaseUrl, config.supabaseKey);
                    document.getElementById('setupPage').classList.remove('active');
                    document.getElementById('loginPage').classList.add('active');
                    await loadAllFiles();
                } catch (error) {
                    console.error('Error loading Supabase:', error);
                }
            }
        });

        async function loadAllFiles() {
            if (!supabaseClient) return;
            
            try {
                const { data, error } = await supabaseClient
                    .from('hr_files')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                Object.keys(sections).forEach(key => files[key] = []);
                
                if (data) {
                    data.forEach(file => {
                        if (files[file.section]) {
                            files[file.section].push(file);
                        }
                    });
                }
                
                updateFileCounts();
            } catch (error) {
                console.error('Error loading files:', error);
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const errorDiv = document.getElementById('loginError');

            if (username === adminCredentials.username && password === adminCredentials.password) {
                loginAs('admin');
                errorDiv.classList.add('hidden');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            } else {
                errorDiv.classList.remove('hidden');
            }
        }

        function loginAsGuest() {
            loginAs('user');
        }

        function loginAs(role) {
            currentUser = role;
            document.getElementById('loginPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
            document.getElementById('userRole').textContent = role === 'admin' ? 'ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„' : 'ğŸ‘¤ Ø²Ø§Ø¦Ø±';
            updateFileCounts();
        }

        function logout() {
            currentUser = '';
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('sectionPage').classList.remove('active');
            document.getElementById('loginPage').classList.add('active');
        }

        function goToSection(sectionId) {
            currentSection = sectionId;
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('sectionPage').classList.add('active');
            
            const section = sections[sectionId];
            document.getElementById('sectionTitle').textContent = section.name;
            document.getElementById('sectionIcon').textContent = section.icon;
            
            const uploadArea = document.getElementById('uploadArea');
            if (currentUser === 'admin') {
                uploadArea.style.display = 'block';
            } else {
                uploadArea.style.display = 'none';
            }
            
            renderFiles();
        }

        function goToHome() {
            document.getElementById('sectionPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
            updateFileCounts();
        }

        function updateFileCounts() {
            Object.keys(sections).forEach(key => {
                const countEl = document.getElementById(`count-${key}`);
                if (countEl) {
                    countEl.textContent = `${files[key].length} Ù…Ù„Ù`;
                }
            });
        }

        function renderFiles() {
            const filesList = document.getElementById('filesList');
            const fileCount = document.getElementById('fileCount');
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            
            const sectionFiles = files[currentSection];
            fileCount.textContent = `${sectionFiles.length} Ù…Ù„Ù`;
            
            if (sectionFiles.length > 0) {
                downloadAllBtn.classList.remove('hidden');
                downloadAllBtn.classList.add('flex');
            } else {
                downloadAllBtn.classList.add('hidden');
            }

            if (sectionFiles.length === 0) {
                filesList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl text-gray-300 mb-4">ğŸ“„</div>
                        <p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>
                        ${currentUser === 'admin' ? '<p class="text-sm text-gray-400 mt-2">Ù‚Ù… Ø¨Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨Ø¯Ø¡</p>' : ''}
                    </div>
                `;
            } else {
                filesList.innerHTML = `
                    <div class="space-y-3">
                        ${sectionFiles.map(file => `
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                <div class="flex items-center gap-3 flex-1">
                                    <div class="bg-blue-100 p-2 rounded text-xl">ğŸ“„</div>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium text-gray-800 truncate">${file.name}</p>
                                        <p class="text-xs text-gray-500">${file.size} â€¢ ${new Date(file.created_at).toLocaleDateString('ar-SA')}</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-2">
                                    <button onclick="downloadFile(${file.id})" class="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors" title="ØªØ­Ù…ÙŠÙ„">
                                        â¬‡ï¸
                                    </button>
                                    ${currentUser === 'admin' ? `
                                        <button onclick="deleteFile(${file.id}, '${file.file_path}')" class="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors" title="Ø­Ø°Ù">
                                            ğŸ—‘ï¸
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        document.getElementById('fileInput').addEventListener('change', async function(e) {
            if (currentUser !== 'admin') return;
            
            const uploadedFiles = Array.from(e.target.files);
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadLabel = document.getElementById('uploadLabel');
            const uploadStatus = document.getElementById('uploadStatus');
            
            uploadProgress.classList.remove('hidden');
            uploadLabel.style.opacity = '0.5';
            uploadLabel.style.pointerEvents = 'none';
            
            try {
                for (let i = 0; i < uploadedFiles.length; i++) {
                    const file = uploadedFiles[i];
                    uploadStatus.textContent = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ${i + 1} Ù…Ù† ${uploadedFiles.length}...`;
                    
                    const fileName = `${Date.now()}_${file.name}`;
                    const filePath = `${currentSection}/${fileName}`;
                    
                    // Upload to storage
                    const { data: uploadData, error: uploadError } = await supabaseClient.storage
                        .from('hr-files')
                        .upload(filePath, file);
                    
                    if (uploadError) throw uploadError;
                    
                    // Get public URL
                    const { data: { publicUrl } } = supabaseClient.storage
                        .from('hr-files')
                        .getPublicUrl(filePath);
                    
                    // Save metadata to database
                    const { data, error } = await supabaseClient
                        .from('hr_files')
                        .insert([
                            {
                                name: file.name,
                                size: (file.size / 1024).toFixed(2) + ' KB',
                                section: currentSection,
                                file_url: publicUrl,
                                file_path: filePath
                            }
                        ])
                        .select();
                    
                    if (error) throw error;
                    
                    if (data && data[0]) {
                        files[currentSection].push(data[0]);
                    }
                }
                
                renderFiles();
                updateFileCounts();
                alert('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª: ' + error.message);
            } finally {
                uploadProgress.classList.add('hidden');
                uploadLabel.style.opacity = '1';
                uploadLabel.style.pointerEvents = 'auto';
                e.target.value = '';
            }
        });

        async function downloadFile(fileId) {
            const file = files[currentSection].find(f => f.id === fileId);
            if (file && file.file_url) {
                const a = document.createElement('a');
                a.href = file.file_url;
                a.download = file.name;
                a.target = '_blank';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }

        async function deleteFile(fileId, filePath) {
            if (currentUser !== 'admin') return;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ')) return;
            
            try {
                // Delete from storage
                const { error: storageError } = await supabaseClient.storage
                    .from('hr-files')
                    .remove([filePath]);
                
                if (storageError) throw storageError;
                
                // Delete from database
                const { error: dbError } = await supabaseClient
                    .from('hr_files')
                    .delete()
                    .eq('id', fileId);
                
                if (dbError) throw dbError;
                
                files[currentSection] = files[currentSection].filter(f => f.id !== fileId);
                renderFiles();
                updateFileCounts();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù: ' + error.message);
            }
        }

        document.getElementById('downloadAllBtn').addEventListener('click', function() {
            files[currentSection].forEach(file => downloadFile(file.id));
        });
    </script>
</body>
</html>
